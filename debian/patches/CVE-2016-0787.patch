Description: Fix bits/bytes confusion bug
 CVE-2016-0787: The diffie_hellman_sha1 function in kex.c
 in libssh2 1.7.0 and prior improperly truncates secrets to 128
 or 256 bits, which makes it easier for
 man-in-the-middle attackers to decrypt or intercept
 SSH sessions via unspecified vectors, aka a
 "bits/bytes confusion bug."
Origin: upstream, https://github.com/libssh2/libssh2/pull/103/commits/41a7b087baa82ce26ad2e02099bce1dd485e835d
Bug: https://github.com/libssh2/libssh2/pull/103
Bug-Ubuntu: https://bugs.launchpad.net/ubuntu/+source/libssh2/+bug/1664812
Forwarded: not-needed
Author: Brian Morton <bmorton@dvidshub.net>
Last-Update: 2017-02-14

--- a/src/kex.c
+++ b/src/kex.c
@@ -103,7 +103,7 @@
         memset(&exchange_state->req_state, 0, sizeof(packet_require_state_t));
 
         /* Generate x and e */
-        _libssh2_bn_rand(exchange_state->x, group_order, 0, -1);
+        _libssh2_bn_rand(exchange_state->x, group_order * 8 - 1, 0, -1);
         _libssh2_bn_mod_exp(exchange_state->e, g, exchange_state->x, p,
                             exchange_state->ctx);
 
